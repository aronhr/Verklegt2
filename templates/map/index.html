{% extends 'base.html' %}
{% load humanize %}
{% block content %}
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: calc(100% - 44px);
            width: 100%;
            position: absolute !important;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <div id="map"></div>
    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 64.835109, lng: -18.696558},
                zoom: 7,
                mapTypeControl: false,
                streetViewControl: false,
            });

            var infowindow = new google.maps.InfoWindow({maxWidth: 400});
            {% autoescape off %}
                {% for x in houses %}
                    var location = {{ x.geo }};
                    // Locations OBJ
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(location),
                        map: map,
                        title: '{{x.address}}'
                    });

                    google.maps.event.addListener(marker, 'click', (function(marker, i) {
                        return function() {
                            var des = '      <div class="card">\n' +
                                '        <div class="card-image">\n' +
                                '          <img src="{{ x.image }}">\n' +
                                '          <span class="card-title">{{ x.address }}</span>\n' +
                                '        </div>\n' +
                                '        <div class="card-content">\n' +
                                '          <p>{{x.description}}</p>\n' +
                                '        </div>\n' +
                                '        <div class="card-action">\n' +
                                '          <a href="/house/{{ x.id }}">Meira um {{ x.address }} </a>\n' +
                                '        </div>\n' +
                                '      </div>';
                            infowindow.setContent(des);
                            infowindow.open(map, marker);
                        }
                    })(marker, {{ x.id}}));
                {% endfor %}
            {% endautoescape %}
        }
    </script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCM--hFf2vF_tToG03z8h6Gmqs6hWwBan4&callback=initMap">
    </script>
{% endblock %}